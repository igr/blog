---
title: JUnit 5
date: 2017-09-11T09:53:22+00:00
slug: junit5
categories:
  - Prikaz
  - Razvoj
tags:
  - framework
  - junit
  - prikaz
  - razvoj
  - test
---

Izgleda da je [Jupiter](https://www.nasa.gov/jupiter/) ove godine zvezda sunÄevog sistema. [JUnit](http://junit.org/junit5/), softverski alat za pisanje unit-testova, je koliko juÄe doÅ¾iveo peto izdanje, na kome se radilo Äak dve godine. Sastoji se od platforme i od, eto, _Jupitera_, kako su veÄ‡ nazvali kombinaciju novog programskog modela za pisanje testova i modela za proÅ¡irivanje u vidu ekstenzija. Evo saÅ¾etka novosti.

## Setup

Nova verzija donosi nova imena artefakata i Java paketa. Da krenemo od Gradle skripta, u kome se novi JUnit potraÅ¾uje sa:

```
group: 'org.junit.jupiter', name: 'junit-jupiter-engine', version: '5.0.0'
```

ili, ako vam je Maven bliÅ¾i:

```xml
<dependency>
	<groupId>org.junit.jupiter</groupId>
	<artifactId>junit-jupiter-engine</artifactId>
	<version>5.0.0</version>
</dependency>
```

Novi paketi su:

```java
import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.assertEquals;
```

Kao Å¡to rekoh, druÅ¾iÄ‡emo se s Jupiterom ğŸ™‚ I da ne zaboravim - novi JUnit zahteva Javu 8!

## Testiranje, uopÅ¡teno

SuÅ¡tina je ostala ista: test metode se oznaÄavaju `@Test` anotacijom, a za proveru ispravnosti se koriste statiÄke metode iz `Assertions` klase. Novost je da test klasa viÅ¡e ne mora da bude javna (`public`).

Tu je i anotacija `@DisplayName` za kratak opis namenjen ispisu na ekran, koja se moÅ¾e postaviti i na metode i na klase.

Metode za proveru taÄnosti (aserti) su unapreÄ‘ene. Za poÄetak, umesto poruke se moÅ¾e koristiti lambda izraz koji vraÄ‡a poruku:

```java
assertTrue(foo > 7, () -> "Value must be greater then 7");
```

Primer nije najbolji poÅ¡to ovo ima smisla onda kada se poruka konstruiÅ¡e iz delova, pa se na ovaj naÄin to odlaÅ¾e do trenutka kada poruka zaista zatreba, Äime se dobija na performansama.

Interesantnija je nova metoda, `assertAll`:

```java
assertAll("foo-bar",
	() -> assertTrue(foo > 7),
	() -> assertEquals(bar == 12)
);
```

Ovde Ä‡e se izvrÅ¡iti svi izlistani testovi, bez obzira da li je neki u meÄ‘uvremenu pao; a u sluÄaju greÅ¡ke baciÄ‡e _exception_ sa informacijama o svim nastalim greÅ¡kama.

Za testiranje nizova i kolekcija, tu su metode: `assertArrayEquals` i `assertIterableEquals()`. Interesantna je moguÄ‡nost testiranja liste stringova naspram regularnog izraza:

```java
List<String> expectedLines = Collections.singletonList("(.*)@(.*)");
List<String> emails = Arrays.asList("igor@gmail.com");
assertLinesMatch(expectedLines, emails);
```

PoÅ¡to JUnit 5 radi na Javi 8, to znaÄi i da je moguÄ‡e koristiti `default` metode kao test metode, kao i da se one mogu oznaÄiti JUnit anotacijama. Ova moguÄ‡nost moÅ¾e da znaÄajno unapredi organizaciju test koda.

## Assumptions

Pretpostavke (_assumption_) kontroliÅ¡u izvrÅ¡avanje testa na osnovu datog uslova:

```java
assumeTrue(external != null);
assertEquals(3, external.foo);
...
assumingThat(
	external != null,
	() -> assertEquals(3, external.foo);
);
```

Drugim reÄima, ukoliko pretpostavka nije ispunjena, test se prekida (baca se `TestAbortedException`). To ne znaÄi da je test neuspeÅ¡an, veÄ‡ samo da nisu ispunjeni preduslovi za njegovo izvrÅ¡enje. NajÄeÅ¡Ä‡e se ovakav test prosto oznaÄi na poseban naÄin (da je izuzet iz testiranja). Pretpostavke se koriste da potvrde stanja koja su definisana van testova, a neophodna su da bi test ispravno radio; no nisu u direktnoj vezi sa onim Å¡to se testira.

## Exceptions

KonaÄno je dodata pomoÄ‡ za testiranju _exceptiona_:

```java
Throwable throwable = assertThrows(SomeException.class, () -> {
	callMethodThatThrowsSomeException();
});
```

Nema viÅ¡e dosadnih `try`-`catch` blokova ili `@Expected` anotacija.

## Disabled

Nova anotacija za iskljuÄivanje testova je `@Disabled`. Ekvivalentna je nekadaÅ¡noj `@Ignore` anotaciji.

## Nested Testovi

UgnjeÅ¾deni testovi su joÅ¡ jedan naÄin kako se testovi mogu grupisati i kojima se definiÅ¡u veze izmeÄ‘u ovih grupa. Primera radi, zamislite da imamo biznis klasu `BookService` sa par metoda: `addBook()`, `updateBook()`, `deleteBook()`. Test sa ugnjeÅ¾denim testovima bi mogao biti napisan ovako:

```java
public class TestBookService {
	@Nested
	@DisplayName("Test Add Feature")
	class AddFeature {
		@Test
		void testBookNameMissing()...
	}

	@Nested
	@DisplayName("Test Update Feature")
	class UpdateFeature {
		@Test
		void testChangeBookName()...
	}
}
```

UgnjeÅ¾deni testovi su prosto inner klase testne klase.

## Tagovi

Dalje, tagovi. Pre smo imali kategorije, sada imamo tagove - joÅ¡ jedan naÄin da se testovi grupiÅ¡u i potom filtriraju:

```java
@Tag("Test case")
public class TaggedTest {
	@Test
	@Tag("important")
	void testMethod()...
}
```

Testovi se sada mogu ukljuÄiti i iskljuÄiti prostim navoÄ‘enjem liste tagova.

## Zbogom `Runner`, `Rule` i `ClassRule`!

Jedna od stvari koja mi se baÅ¡ dopala je to da je JUnit 5 izbacio `Runner`, `Rule` i `ClassRule` klase. Nikada mi se sasvim nije dopalo kako se koriste u praksi. U novoj verziji JUnit-a one su mudro zamenjene samo jednim koceptom - modelom za ekstenzije.

Ekstenzije se primenjuju deklarativno, anotacijom test klase ili metode s `@ExtendedWith`. Na primer, ukoliko imamo test kome neka polja u klasi treba inicijalizovati mokupovima, moÅ¾e se napisati sledeÄ‡e:

```java
@ExtendedWith(MockitoExtension.class)
class MyMockedTest {
	@Mock
	Book book;
	...
}
```

## Before i After

Uveden je red u anotacije kojima se oznaÄavaju metode kojima se test inicijalizuje i finalizuje. Nove anotacije su: `BeforeEach`, `@BeforeAll`, `@AfterEach`, `@AfterAll`. Jednostavno i jasno Äemu sluÅ¾e.

Novi JUnit radi kao i do sada: kreira novu instancu svake test klase pre izvrÅ¡enja _svake_ test metode. Ovakav naÄin rada je podrazumevani i naziva se â€œ_per-method_â€. No ovo se moÅ¾e promeniti: kada se testna klasa oznaÄi sa `@TestInstance(Lifecycle.PER_CLASS)`, JUnit prelazi na â€œ_per-class_â€ naÄin rada. U ovom modu se za svaku testnu klasu pravi samo jedna instanca.

## DinamiÄki testovi

SliÄna ideji `Parameterized` testova, Junit 5 donosi `@TestFactory` i dinamiÄke testove:

```java
@TestFactory
public Stream<DynamicTest> createStringGetLengthTests() {
	final String[][] data = {
		{"oblac", "5"},
		{"jodd", "4"},
		{"", "0"}
	};
	return Stream.of(data).map(in -> dynamicTest(
		"test: " + in[0],
		() -> assertEquals(in[1], String.valueOf(in.getLength(in[0]))));
}
```

`@TestFactory`, kao Å¡to mu i ime kaÅ¾e, proizvodi niz dinamiÄkih testova.

## PonavljaÄi

Testovi se sada mogu ponavljati ukoliko se oznaÄe sa `@RepeatedTest`:

```java
@RepeatedTest(3)
public void test(RepetitionInfo info) {
	assertTrue(1 == 1);
	logger.info("Repetition #" + info.getCurrentRepetition());
}
```

Test metod sada dozvoljava argument tipa `RepetitionInfo` koji sadrÅ¾i meta-podatke u vezi ponavljanja. JoÅ¡ nisam sasvim siguran kada bih koristio ovu moguÄ‡nost, no vremenom Ä‡e se to pojasniti.

## Dependency Injection

Osim `RepetitionInfo`, JUnit5 test metode dozvoljavaju parametre tipa `TestInfo` i `TestReporter`. Ove klase sadrÅ¾e meta-podatke koji se tiÄu samog testa (klasa, metoda, ime...).

## Ispod Haube

JUnit 5 nije samo tek unapreÄ‘ena verzija JUnita. SuÅ¡tina nove verzije zapravo leÅ¾i u novoj arhitekturi. JUnit 5 je konstruisan tako da dozvoljava koriÅ¡Ä‡enje drugih testnih biblioteka i razliÄitih implementacija. Dok god se one nastavljaju na JUnit 5 arhitekturu, postaje moguÄ‡e imati izbor i promeniti testnu biblioteku bez izmene koda. To olakaÅ¡ava posao i okruÅ¾enjima za razvoj (IDE), poÅ¡to bi se testovati tretirali i izvrÅ¡avali na isti naÄin, bez obzira na implementaciju.

Iza svega stoji i [Open Test Alliance](https://github.com/ota4j-team/opentest4j) incijativa, zvaniÄno telo za standardizaciju testova.

## Sedi, pet!

JUnit 5 definitivno predstavlja znaÄajan pomak i prekretnicu u sferi unit testova. Imam utisak da su stvari sada konceptualno ujednaÄene. Drago mi je Å¡to se autori nisu libili da promene ili izbace neke stvari koje su i mene samog Å¾uljale, te i da su zamenjene oÄigledno promiÅ¡ljenim novim funkcionalnostima, koje Äine razvoj lakÅ¡im. Ne znam kako vi, ali Ä‡u koliko danas zapoÄeti sa nadogradnjom na projektima na kojima radim.